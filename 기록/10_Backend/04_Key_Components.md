# μ£Όμ” μ»΄ν¬λ„νΈ λ° λ΅μ§ (Key Components)

## π•’ Focus Service

μ‚¬μ©μμ μ§‘μ¤‘ μ„Έμ…μ„ κ΄€λ¦¬ν•©λ‹λ‹¤.

- **μ„Έμ… μΆ…λ£ (`finishSession`)**:
  - ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° `startAt`, `videoIds` λ“±μ„ λ°›μ•„ μ§‘μ¤‘ μ‹κ°„μ„ κ³„μ‚°ν•©λ‹λ‹¤.
  - `User`μ `totalFocusSec`λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.
  - `FocusLog` μ—”ν‹°ν‹°λ¥Ό μƒμ„±ν•μ—¬ κΈ°λ΅μ„ μ €μ¥ν•©λ‹λ‹¤.
  - ν«μ μƒνƒ(`happiness`, `boredom`)λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤.

## π¶ Pet Service & Logic

ν«μ μƒνƒ λ³€ν™”λ” μ‹κ°„ κΈ°λ°μΌλ΅ κ³„μ‚°λ©λ‹λ‹¤.

- **μƒνƒ κ³„μ‚° (`getCalculated...`)**:
  - ν«μ λ§μ§€λ§‰ μƒνΈμ‘μ© μ‹κ°„(`lastUpdated`)κ³Ό ν„μ¬ μ‹κ°„μ μ°¨μ΄λ¥Ό κµ¬ν•©λ‹λ‹¤.
  - **ν–‰λ³µλ„(Happiness)**: μ‹κ°„μ΄ μ§€λ‚ μλ΅ κ°μ† (`-0.00055 / sec`).
  - **μ‹¬μ‹¬ν•¨(Boredom)**: μ‹κ°„μ΄ μ§€λ‚ μλ΅ μ¦κ°€ (`+0.028 / sec`).
- **μƒνΈμ‘μ© (`interactWithPet`)**:
  - μ“°λ‹¤λ“¬κΈ°(API νΈμ¶) μ‹ ν–‰λ³µλ„ μ¦κ°€, μ‹¬μ‹¬ν•¨ κ°μ† ν¨κ³Όλ¥Ό μ μ©ν•κ³  `lastUpdated`λ¥Ό κ°±μ‹ ν•©λ‹λ‹¤.

## π“΅ Real-time Service (SSE & Room)

μ‚¬μ©μ κ°„μ μ‹¤μ‹κ°„ μμ•… κ³µμ λ¥Ό μ„ν•΄ Server-Sent Events (SSE)λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

### SseService

- **`subscribe(email)`**:
  - ν΄λΌμ΄μ–ΈνΈκ°€ `/api/connect/{email}`λ΅ μ ‘μ†ν•λ©΄ SSE Emitterλ¥Ό μƒμ„±ν•μ—¬ μ €μ¥ν•©λ‹λ‹¤.
  - μ—°κ²° λκΉ€ μ‹ μλ™μΌλ΅ Emitterλ¥Ό μ κ±°ν•©λ‹λ‹¤.
- **`broadcastToRoom(ownerEmail, eventName, data)`**:
  - νΉμ • λ°©(User ID κΈ°μ¤€)μ— μ°Έμ—¬ μ¤‘μΈ λ¨λ“  μ‚¬μ©μμ—κ² μ΄λ²¤νΈλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.

### RoomService

- λ°© μ ‘μ† κ΄€λ¦¬λ” Redis λλ” μΈλ©”λ¨λ¦¬ μλ£κµ¬μ΅°λ¥Ό μ‚¬μ©ν•  κ²ƒμΌλ΅ μ¶”μ •λ©λ‹λ‹¤.
- **`joinRoom` / `leaveRoom`**: μ°Έμ—¬μλ¥Ό κ΄€λ¦¬ν•κ³  μ…μ¥ μ‹ ν„μ¬ μ¬μƒ μ¤‘μΈ μμ•… μ •λ³΄λ¥Ό λ°ν™ν•©λ‹λ‹¤.
- **`syncMusic`**: λ°©μ¥(Owner)μ΄ μμ•…μ„ λ³€κ²½ν•κ±°λ‚ μΌμ‹μ •μ§€ν•λ©΄, μ΄λ¥Ό SSEλ¥Ό ν†µν•΄ κµ¬λ…μλ“¤μ—κ² μ „νν•©λ‹λ‹¤.
